{"version":3,"file":"plugins/plugin.autoplay.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./src/plugins/plugin.autoplay.js"],"sourcesContent":["/*global BookReader */\r\n\r\n/**\r\n * Plugin which adds an autoplay feature. Useful for kiosk situations.\r\n */\r\njQuery.extend(BookReader.defaultOptions, {\r\n  enableAutoPlayPlugin: true\r\n});\r\n\r\n/**\r\n * @override BookReader.setup\r\n */\r\nBookReader.prototype.setup = (function(super_) {\r\n  return function (options) {\r\n    super_.call(this, options);\r\n\r\n    this.auto      = false;\r\n    this.autoTimer = null;\r\n    this.flipDelay = 5000;\r\n  };\r\n})(BookReader.prototype.setup);\r\n\r\n/**\r\n * @override BookReader.init\r\n */\r\nBookReader.prototype.init = (function(super_) {\r\n  return function (options) {\r\n    super_.call(this, options);\r\n\r\n    if (!this.options.enableAutoPlayPlugin) return;\r\n    this.bind(BookReader.eventNames.stop, () => this.autoStop());\r\n  };\r\n})(BookReader.prototype.init);\r\n\r\n/**\r\n * @override BookReader.bindNavigationHandlers\r\n */\r\nBookReader.prototype.bindNavigationHandlers = (function(super_) {\r\n  return function() {\r\n    super_.call(this);\r\n\r\n    if (!this.options.enableAutoPlayPlugin) return;\r\n\r\n    const jIcons = this.$('.BRicon');\r\n\r\n    jIcons.filter('.play').click(() => {\r\n      this.autoToggle();\r\n      return false;\r\n    });\r\n\r\n    jIcons.filter('.pause').click(() => {\r\n      this.autoToggle();\r\n      return false;\r\n    });\r\n  };\r\n})(BookReader.prototype.bindNavigationHandlers);\r\n\r\n/**\r\n * Starts autoplay mode\r\n * @param {object} overrides\r\n * @param {number} overrides.flipSpeed\r\n * @param {number} overrides.flipDelay\r\n */\r\nBookReader.prototype.autoToggle = function(overrides) {\r\n  if (!this.options.enableAutoPlayPlugin) return;\r\n\r\n  const options = $.extend({\r\n    flipSpeed: this.flipSpeed,\r\n    flipDelay: this.flipDelay\r\n  }, overrides);\r\n\r\n  this.flipSpeed = typeof options.flipSpeed === \"number\" ? options.flipSpeed : this.flipSpeed;\r\n  this.flipDelay = typeof options.flipDelay === \"number\" ? options.flipDelay : this.flipDelay;\r\n  this.trigger(BookReader.eventNames.stop);\r\n\r\n  let bComingFrom1up = false;\r\n  if (this.constMode2up != this.mode) {\r\n    bComingFrom1up = true;\r\n    this.switchMode(this.constMode2up);\r\n  }\r\n\r\n  if (null == this.autoTimer) {\r\n    // $$$ Draw events currently cause layout problems when they occur during animation.\r\n    //     There is a specific problem when changing from 1-up immediately to autoplay in RTL so\r\n    //     we workaround for now by not triggering immediate animation in that case.\r\n    //     See https://bugs.launchpad.net/gnubook/+bug/328327\r\n    if (('rl' == this.pageProgression) && bComingFrom1up) {\r\n      // don't flip immediately -- wait until timer fires\r\n    } else {\r\n      // flip immediately\r\n      this.next({ triggerStop: false });\r\n    }\r\n\r\n    this.$('.play').hide();\r\n    this.$('.pause').show();\r\n    this.autoTimer = setInterval(() => {\r\n      if (this.animating) return;\r\n\r\n      if (Math.max(this.twoPage.currentIndexL, this.twoPage.currentIndexR) >= this.book.getNumLeafs() - 1) {\r\n        this.prev({ triggerStop: false }); // $$$ really what we want?\r\n      } else {\r\n        this.next({ triggerStop: false });\r\n      }\r\n    }, this.flipDelay);\r\n  } else {\r\n    this.autoStop();\r\n  }\r\n};\r\n\r\n/**\r\n * Stop autoplay mode, allowing animations to finish\r\n */\r\nBookReader.prototype.autoStop = function() {\r\n  if (!this.options.enableAutoPlayPlugin) return;\r\n\r\n  if (null != this.autoTimer) {\r\n    clearInterval(this.autoTimer);\r\n    this.flipSpeed = 'fast';\r\n    this.$('.pause').hide();\r\n    this.$('.play').show();\r\n    this.autoTimer = null;\r\n  }\r\n};\r\n"],"names":["jQuery","extend","BookReader","defaultOptions","enableAutoPlayPlugin","prototype","setup","super_","options","call","auto","autoTimer","flipDelay","init","bind","eventNames","stop","autoStop","bindNavigationHandlers","jIcons","$","filter","click","autoToggle","overrides","flipSpeed","trigger","bComingFrom1up","constMode2up","mode","switchMode","pageProgression","next","triggerStop","hide","show","setInterval","animating","Math","max","twoPage","currentIndexL","currentIndexR","book","getNumLeafs","prev","clearInterval"],"sourceRoot":""}