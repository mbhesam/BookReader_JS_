{"version":3,"file":"plugins/plugin.resume.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./src/plugins/plugin.resume.js","webpack://@internetarchive/bookreader/./src/util/docCookies.js"],"sourcesContent":["import * as docCookies from '../util/docCookies.js';\r\n\r\n/* global BookReader */\r\n\r\n/** @deprecated Exposed for backward compatibility */\r\nBookReader.docCookies = docCookies;\r\n\r\n/**\r\n * Plugin to remember the current page number in a cookie\r\n */\r\njQuery.extend(BookReader.defaultOptions, {\r\n  enablePageResume: true,\r\n  /** @type {string|null} eg '/', '/details/id' */\r\n  resumeCookiePath: null,\r\n});\r\n\r\n/** @override */\r\nBookReader.prototype.init = (function(super_) {\r\n  return function() {\r\n    super_.call(this);\r\n    if (this.options.enablePageResume) {\r\n      this.bind(BookReader.eventNames.fragmentChange, () => {\r\n        const params = this.paramsFromCurrent();\r\n        this.updateResumeValue(params.index);\r\n      });\r\n    }\r\n  };\r\n})(BookReader.prototype.init);\r\n\r\n/**\r\n * Gets page resume value, for remembering reader's page\r\n * Can be overridden for different implementation\r\n *\r\n * @return {number|null}\r\n */\r\nBookReader.prototype.getResumeValue = function() {\r\n  const val = BookReader.docCookies.getItem('br-resume');\r\n  if (val !== null) return parseInt(val);\r\n  else return null;\r\n};\r\n\r\n/**\r\n * Return cookie path using pathname up to /page/... or /mode/...\r\n * using window.location.pathname for urlPathPart:\r\n * - matches encoding\r\n * - ignores querystring part\r\n * - ignores fragment part (after #)\r\n * @param {string} urlPathPart - window.location.pathname\r\n */\r\nBookReader.prototype.getCookiePath = function(urlPathPart) {\r\n  return urlPathPart.match('.+?(?=/page/|/mode/|$)')[0];\r\n};\r\n\r\n/**\r\n * Sets page resume value, for remembering reader's page\r\n * Can be overridden for different implementation\r\n *\r\n * @param {Number} index leaf index\r\n * @param {string} [cookieName]\r\n */\r\nBookReader.prototype.updateResumeValue = function(index, cookieName) {\r\n  const ttl = new Date(+new Date + 12096e5); // 2 weeks\r\n  // For multiple files in item, leave resumeCookiePath blank\r\n  // It's likely we can remove resumeCookiePath using getCookiePath()\r\n  const path = this.options.resumeCookiePath\r\n    || this.getCookiePath(window.location.pathname);\r\n  BookReader.docCookies.setItem(cookieName || 'br-resume', index, ttl, path, null, false);\r\n};\r\n","/**\r\n * Helper module use to get, set and remove item from cookie\r\n *\r\n * See more:\r\n *  https://developer.mozilla.org/en-US/docs/Web/API/document.cookie\r\n *  https://developer.mozilla.org/User:fusionchess\r\n *  https://github.com/madmurphy/cookies.js\r\n *  This framework is released under the GNU Public License, version 3 or later.\r\n *  http://www.gnu.org/licenses/gpl-3.0-standalone.html\r\n */\r\n\r\n/**\r\n * Check to see if the browser has cookies enabled.\r\n * Accessing document.cookies errors if eg iframe with sandbox enabled.\r\n * @returns {boolean}\r\n */\r\nexport function areCookiesBlocked(doc = document) {\r\n  try {\r\n    doc.cookie;\r\n    return false;\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n}\r\n\r\nconst COOKIES_BLOCKED = areCookiesBlocked();\r\n\r\n/**\r\n * Get specific key's value stored in cookie\r\n *\r\n * @param {string} sKey\r\n *\r\n * @returns {string|null}\r\n */\r\nexport function getItem(sKey) {\r\n  if (COOKIES_BLOCKED || !sKey) return null;\r\n\r\n  return decodeURIComponent(\r\n    // eslint-disable-next-line no-useless-escape\r\n    document.cookie.replace(new RegExp('(?:(?:^|.*;)\\\\s*' + encodeURIComponent(sKey).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') + '\\\\s*\\\\=\\\\s*([^;]*).*$)|^.*$'), '$1')) || null;\r\n}\r\n\r\n/**\r\n * Set specific key's value in cookie\r\n *\r\n * @param {string} sKey cookie name\r\n * @param {string} sValue cookie value\r\n * @param {string} [vEnd] expire|max-age\r\n * @param {string} [sPath] path of current item\r\n * @param {string} [sDomain] domain name\r\n * @param {boolean} [bSecure]\r\n *\r\n * @returns {boolean}\r\n */\r\nexport function setItem(sKey, sValue, vEnd, sPath, sDomain, bSecure) {\r\n  if (COOKIES_BLOCKED) return false;\r\n\r\n  document.cookie = encodeURIComponent(sKey) + '=' + encodeURIComponent(sValue)\r\n  + (vEnd ? `; expires=${vEnd.toUTCString()}` : '')\r\n  + (sDomain ? `; domain=${sDomain}` : '')\r\n  + (sPath ? `; path=${sPath}` : '')\r\n  + (bSecure ? `; secure` : '');\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * BROKEN Remove specific key's value from cookie\r\n * @fixme hasItem isn't even implemented! This will always error.\r\n * @param {string} sKey cookie name\r\n * @param {string} [sPath] path of current item\r\n * @param {string} [sDomain]\r\n *\r\n * @returns {boolean}\r\n */\r\nexport function removeItem(sKey, sPath, sDomain) {\r\n  if (COOKIES_BLOCKED) return false;\r\n  // eslint-disable-next-line\r\n  if (!hasItem(sKey)) return false;\r\n\r\n  document.cookie = encodeURIComponent(sKey) + `=; expires=Thu, 01 Jan 1970 00:00:00 GMT`\r\n  + (sDomain ? `; domain=${sDomain}` : '')\r\n  + (sPath ? `; path=${sPath}` : '');\r\n\r\n  return true;\r\n}\r\n"],"names":["docCookies","BookReader","jQuery","extend","defaultOptions","enablePageResume","resumeCookiePath","prototype","init","super_","call","options","bind","eventNames","fragmentChange","params","paramsFromCurrent","updateResumeValue","index","getResumeValue","val","getItem","parseInt","getCookiePath","urlPathPart","match","cookieName","ttl","Date","path","window","location","pathname","setItem","areCookiesBlocked","doc","document","cookie","e","COOKIES_BLOCKED","sKey","decodeURIComponent","replace","RegExp","encodeURIComponent","sValue","vEnd","sPath","sDomain","bSecure","toUTCString","removeItem","hasItem"],"sourceRoot":""}