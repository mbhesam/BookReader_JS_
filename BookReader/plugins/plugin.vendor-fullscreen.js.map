{"version":3,"file":"plugins/plugin.vendor-fullscreen.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./src/plugins/plugin.vendor-fullscreen.js"],"sourcesContent":["/* global BookReader */\r\n\r\n/**\r\n * Toggles browser's native fullscreen mode if available device is not mobile\r\n */\r\nif (!isMobile()) {\r\n  const EVENT_NAMESPACE = '.bookreader_vendor-fullscreen';\r\n\r\n  jQuery.extend(BookReader.defaultOptions, {\r\n    /** @type {boolean} */\r\n    enableVendorFullscreenPlugin: true\r\n  });\r\n\r\n  /** @override */\r\n  BookReader.prototype.setup = (function(super_) {\r\n    return function(options) {\r\n      super_.call(this, options);\r\n\r\n      this.isVendorFullscreenActive = false;\r\n    };\r\n  })(BookReader.prototype.setup);\r\n\r\n  /** @override */\r\n  BookReader.prototype.getInitialMode = (function(super_) {\r\n    return function(params) {\r\n      let nextMode = super_.call(this, params);\r\n      if (this.isVendorFullscreenActive) {\r\n        nextMode = this.constMode1up;\r\n      }\r\n      return nextMode;\r\n    };\r\n  })(BookReader.prototype.getInitialMode);\r\n\r\n  /** @override */\r\n  BookReader.prototype.init = (function(super_) {\r\n    return function() {\r\n      super_.call(this);\r\n\r\n      if (!fullscreenAllowed()) {\r\n        return;\r\n      }\r\n      // In fullscreen mode the colorbox and overlay need to be inside the fullscreen element to display properly.\r\n      bindFullscreenChangeListener(this, (e) => {\r\n        e.data.resize();\r\n        e.data.updateBrClasses();\r\n        const cboxOverlay = $('#cboxOverlay');\r\n        const cbox = $('#colorbox');\r\n        if (isFullscreenActive()) {\r\n          // In full screen mode, the colorbox and overlay need\r\n          // to be children of the fullscreen element to display properly.\r\n          const $fullscreen = $(getFullscreenElement());\r\n          $fullscreen.append(cboxOverlay).append(cbox);\r\n        } else {\r\n          // In non-fullscreen mode, the colorbox and overlay need\r\n          // to be children of the main document body.\r\n          $(document.body).append(cboxOverlay).append(cbox);\r\n        }\r\n      });\r\n    };\r\n  })(BookReader.prototype.init);\r\n\r\n  /**\r\n   * Start fullscreen mode\r\n   */\r\n  BookReader.prototype.enterFullWindow = function() {\r\n    this.refs.$brContainer.css('opacity', 0);\r\n\r\n    const windowWidth = $(window).width();\r\n    if (windowWidth <= this.onePageMinBreakpoint) {\r\n      this.switchMode(this.constMode1up);\r\n    }\r\n\r\n    this.isVendorFullscreenActive = true;\r\n    this.updateBrClasses();\r\n\r\n    this.resize();\r\n    this.jumpToIndex(this.currentIndex());\r\n\r\n    this.refs.$brContainer.animate({ opacity: 1 }, 400, 'linear');\r\n\r\n    $(document).on(`keyup.${EVENT_NAMESPACE}`, e => {\r\n      if (e.keyCode === 27) this.exitFullScreen();\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Exit from fullscreen mode\r\n   */\r\n  BookReader.prototype.exitFullWindow = function() {\r\n    this.refs.$brContainer.css('opacity', 0);\r\n\r\n    $(document).off('keyup' + EVENT_NAMESPACE);\r\n\r\n    this.isFullscreenActive = false;\r\n    this.updateBrClasses();\r\n\r\n    this.resize();\r\n    this.refs.$brContainer.animate({ opacity: 1 }, 400, 'linear');\r\n  };\r\n\r\n  /**\r\n   * Returns true if fullscreen mode is enabled\r\n   *\r\n   * @returns {boolean}\r\n   */\r\n  BookReader.prototype.isFullscreen = function() {\r\n    return isFullscreenActive() || this.isVendorFullscreenActive;\r\n  };\r\n\r\n  /**\r\n   * Toggle screen\r\n   */\r\n  BookReader.prototype.toggleFullscreen = function() {\r\n    if (this.isFullscreen()) {\r\n      if (fullscreenAllowed()) {\r\n        exitFullscreen();\r\n      } else {\r\n        this.exitFullWindow();\r\n      }\r\n    } else {\r\n      if (fullscreenAllowed()) {\r\n        requestFullscreen(this.refs.$br[0]);\r\n      } else {\r\n        this.enterFullWindow();\r\n      }\r\n    }\r\n  };\r\n\r\n  /** @deprecated */\r\n  BookReader.util.isMobile = isMobile;\r\n\r\n  /** @deprecated */\r\n  BookReader.util.getFullscreenElement = getFullscreenElement;\r\n\r\n  /** @deprecated */\r\n  BookReader.util.bindFullscreenChangeListener = bindFullscreenChangeListener;\r\n\r\n  /** @deprecated */\r\n  BookReader.util.fullscreenAllowed = fullscreenAllowed;\r\n\r\n  /** @deprecated */\r\n  BookReader.util.requestFullscreen = requestFullscreen;\r\n\r\n  /** @deprecated */\r\n  BookReader.util.exitFullscreen = exitFullscreen;\r\n\r\n  /** @deprecated */\r\n  BookReader.util.isFullscreenActive = isFullscreenActive;\r\n}\r\n\r\n\r\n/**\r\n * Returns the DOM element being used for fullscreen.\r\n *\r\n * @returns {HTMLElement}\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/DocumentOrShadowRoot/fullscreenElement\r\n */\r\nexport function getFullscreenElement() {\r\n  return document.fullscreenElement ||\r\n    document.webkitFullscreenElement ||\r\n    document.mozFullScreenElement ||\r\n    document.msFullscreenElement;\r\n}\r\n\r\n/**\r\n * Returns true if the document is in fullscreen mode.\r\n *\r\n * @returns {boolean}\r\n */\r\nexport function isFullscreenActive() {\r\n  const fullscreenElement = getFullscreenElement();\r\n  return fullscreenElement !== null && fullscreenElement !== undefined;\r\n}\r\n\r\n/**\r\n * Exits fullscreen mode.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/exitFullscreen\r\n */\r\nexport function exitFullscreen() {\r\n  if (document.exitFullscreen) {\r\n    document.exitFullscreen();\r\n  } else if (document.webkitExitFullscreen) {\r\n    document.webkitExitFullscreen();\r\n  } else if (document.mozCancelFullScreen) {\r\n    document.mozCancelFullScreen();\r\n  } else if (document.msExitFullscreen) {\r\n    document.msExitFullscreen();\r\n  }\r\n}\r\n\r\n/**\r\n * Requests fullscreen mode for the given element\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/requestFullscreen\r\n */\r\nexport function requestFullscreen(element) {\r\n  if (element.requestFullscreen) {\r\n    element.requestFullscreen();\r\n  } else if (element.webkitRequestFullscreen) {\r\n    element.webkitRequestFullscreen();\r\n  } else if (element.mozRequestFullScreen) {\r\n    element.mozRequestFullScreen();\r\n  } else if (element.msRequestFullscreen) {\r\n    element.msRequestFullscreen();\r\n  }\r\n}\r\n\r\n/**\r\n * Returns true if fullscreen mode is allowed on this device and document.\r\n *\r\n * @returns {boolean}\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/fullscreenEnabled\r\n */\r\nexport function fullscreenAllowed() {\r\n  return (document.fullscreenEnabled ||\r\n    document.webkitFullscreenEnabled ||\r\n    document.mozFullScreenEnabled ||\r\n    document.msFullScreenEnabled);\r\n}\r\n\r\n/**\r\n * jQuery-style binding to a fullscreenchange event.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/fullscreenchange_event\r\n */\r\nexport function bindFullscreenChangeListener(\r\n  data, fullscreenchangeListener\r\n) {\r\n  const event = 'fullscreenchange ';\r\n  const vendor_prefixes = [\r\n    'webkit',\r\n    'moz',\r\n    'ms'\r\n  ];\r\n  const all_events = (event + vendor_prefixes.join(event) + event).trim();\r\n  $(document).on(all_events, data, fullscreenchangeListener);\r\n}\r\n\r\n/**\r\n * Returns true if current device is mobile\r\n *\r\n * @returns {boolean}\r\n */\r\nexport function isMobile() {\r\n  return (typeof window.orientation !== 'undefined') || (navigator.userAgent.indexOf('IEMobile') !== -1);\r\n}\r\n"],"names":["isMobile","EVENT_NAMESPACE","jQuery","extend","BookReader","defaultOptions","enableVendorFullscreenPlugin","prototype","setup","super_","options","call","isVendorFullscreenActive","getInitialMode","params","nextMode","constMode1up","init","fullscreenAllowed","bindFullscreenChangeListener","e","data","resize","updateBrClasses","cboxOverlay","$","cbox","isFullscreenActive","$fullscreen","getFullscreenElement","append","document","body","enterFullWindow","refs","$brContainer","css","windowWidth","window","width","onePageMinBreakpoint","switchMode","jumpToIndex","currentIndex","animate","opacity","on","keyCode","exitFullScreen","exitFullWindow","off","isFullscreen","toggleFullscreen","exitFullscreen","requestFullscreen","$br","util","fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement","undefined","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen","element","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullScreenEnabled","fullscreenchangeListener","event","vendor_prefixes","all_events","join","trim","orientation","navigator","userAgent","indexOf"],"sourceRoot":""}