{"version":3,"file":"plugins/plugin.chapters.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./node_modules/@internetarchive/icon-toc/icon-toc.js","webpack://@internetarchive/bookreader/./node_modules/@internetarchive/icon-toc/index.js","webpack://@internetarchive/bookreader/./src/plugins/plugin.chapters.js","webpack://@internetarchive/bookreader/../../src/directives/if-defined.ts"],"sourcesContent":["import icon from './index.js';\nimport { css, LitElement } from 'lit';\n\nclass IAIconToc extends LitElement {\n  static get styles() {\n    return css`\n      :host {\n        width: var(--iconWidth, 'auto');\n        height: var(--iconHeight, 'auto');\n      }\n\n      .fill-color {\n        fill: var(--iconFillColor);\n      }\n\n      .stroke-color {\n        stroke: var(--iconStrokeColor);\n      }\n    `;\n  }\n\n  render() {\n    return icon;\n  }\n}\n\ncustomElements.define('ia-icon-toc', IAIconToc);\n\nexport default IAIconToc;\n","import { html } from 'lit';\n\nexport default html`\n<svg\n  viewBox=\"0 0 24 24\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n  aria-labelledby=\"tocTitleID tocDescID\"\n>\n  <title id=\"tocTitleID\">Table of contents icon</title>\n  <desc id=\"tocDescID\">An illustration of three text list items</desc>\n  <g class=\"fill-color\" fill-rule=\"evenodd\"><rect height=\"3\" rx=\"1.5\" width=\"18\" x=\"6\"/><rect height=\"3\" rx=\"1.5\" width=\"18\" x=\"6\" y=\"21\"/><rect height=\"3\" rx=\"1.5\" width=\"18\" x=\"6\" y=\"14\"/><rect height=\"3\" rx=\"1.5\" width=\"18\" x=\"6\" y=\"7\"/><rect height=\"3\" rx=\"1.5\" width=\"4\"/><rect height=\"3\" rx=\"1.5\" width=\"4\" y=\"21\"/><rect height=\"3\" rx=\"1.5\" width=\"4\" y=\"14\"/><rect height=\"3\" rx=\"1.5\" width=\"4\" y=\"7\"/></g>\n</svg>\n`;\n","/* global BookReader */\r\nimport { css, html, LitElement, nothing } from \"lit\";\r\nimport { customElement, property } from 'lit/decorators.js';\r\nimport { ifDefined } from 'lit/directives/if-defined.js';\r\nimport { styleMap } from 'lit/directives/style-map.js';\r\nimport '@internetarchive/icon-toc/icon-toc';\r\n/** @typedef {import('@/src/BookNavigator/book-navigator.js').BookNavigator} BookNavigator */\r\n\r\n/**\r\n * Plugin for chapter markers in BookReader. Fetches from openlibrary.org\r\n * Could be forked, or extended to alter behavior\r\n */\r\n\r\n// jQuery.extend(BookReader.defaultOptions, {\r\n//   olHost: 'https://openlibrary.org',\r\n//   enableChaptersPlugin: true,\r\n//   bookId: '',\r\n// });\r\n\r\n/** @override Extend to call Open Library for TOC */\r\nBookReader.prototype.init = (function(super_) {\r\n  return function() {\r\n    super_.call(this);\r\n    if (this.options.enableChaptersPlugin && this.ui !== 'embed') {\r\n      this._chapterInit();\r\n    }\r\n  };\r\n})(BookReader.prototype.init);\r\n\r\nBookReader.prototype._chapterInit = async function() {\r\n  let rawTableOfContents = null;\r\n  // Prefer IA TOC for now, until we update the second half to check for\r\n  // `openlibrary_edition` on the IA metadata instead of making a bunch of\r\n  // requests to OL.\r\n  if (this.options.table_of_contents?.length) {\r\n    rawTableOfContents = this.options.table_of_contents;\r\n  }\r\n\r\n  if (rawTableOfContents) {\r\n    this._tocEntries = rawTableOfContents\r\n      // .map(rawTOCEntry => (Object.assign({}, rawTOCEntry, {\r\n      //   pageIndex: (\r\n      //     typeof(rawTOCEntry.leaf) == 'number' ? this.book.leafNumToIndex(rawTOCEntry.leaf) :\r\n      //       rawTOCEntry.pagenum ? this.book.getPageIndex(rawTOCEntry.pagenum) :\r\n      //         undefined\r\n      //   ),\r\n      // })));\r\n    this._chaptersRender(this._tocEntries);\r\n    // this.bind(BookReader.eventNames.pageChanged, () => this._chaptersUpdateCurrent());\r\n  }\r\n};\r\n\r\n/**\r\n * Update the table of contents based on array of TOC entries.\r\n */\r\nBookReader.prototype._chaptersRender = function() {\r\n  const shell = /** @type {BookNavigator} */(this.shell);\r\n  shell.menuProviders['chapters'] = {\r\n    id: 'chapters',\r\n    icon: html`<ia-icon-toc style=\"width: var(--iconWidth); height: var(--iconHeight);\"></ia-icon-toc>`,\r\n    label: 'جلدهای دیگر',\r\n    component: html`<br-chapters-panel\r\n      .contents=\"${this._tocEntries}\"\r\n      .jumpToPage=\"${(pageIndex) => {\r\n      this._chaptersUpdateCurrent(pageIndex);\r\n      this.jumpToIndex(pageIndex);\r\n    }}\"\r\n      @connected=\"${(e) => {\r\n      this._chaptersPanel = e.target;\r\n      this._chaptersUpdateCurrent();\r\n    }}\"\r\n    />`,\r\n  };\r\n  shell.addMenuShortcut('chapters');\r\n  shell.updateMenuContents();\r\n  this._tocEntries.forEach((tocEntry, i) => this._chaptersRenderMarker(tocEntry, i));\r\n};\r\n\r\n/**\r\n * @typedef {Object} TocEntry\r\n * Table of contents entry as defined by Open Library, with some extra values for internal use\r\n * @property {number} [level]\r\n * @property {string} [label]\r\n * @property {string} [title]\r\n * @property {PageString} [pagenum]\r\n * @property {LeafNum} [leaf]\r\n * @property {number} [pageIndex] - Added\r\n *\r\n * @example {\r\n *   \"pagenum\": \"17\",\r\n *   \"level\": 1,\r\n *   \"label\": \"CHAPTER I\",\r\n *   \"title\": \"THE COUNTRY AND THE MISSION\"\r\n * }\r\n */\r\n\r\n/**\r\n * @param {TocEntry} tocEntry\r\n * @param {number} entryIndex\r\n */\r\nBookReader.prototype._chaptersRenderMarker = function(tocEntry, entryIndex) {\r\n  if (tocEntry.pageIndex == undefined) return;\r\n\r\n  //creates a string with non-void tocEntry.label and tocEntry.title\r\n  const chapterStr = [tocEntry.label, tocEntry.title]\r\n    .filter(x => x)\r\n    .join(' ') || `Chapter ${entryIndex + 1}`;\r\n\r\n  const percentThrough = BookReader.util.cssPercentage(tocEntry.pageIndex, this.book.getNumLeafs() - 1);\r\n  $(`<div></div>`)\r\n    .append(\r\n      $('<div />')\r\n        .text(chapterStr)\r\n        .append(\r\n          $('<div class=\"BRchapterPage\" />')\r\n            .text(this.book.getPageName(tocEntry.pageIndex))\r\n        )\r\n    )\r\n    .addClass('BRchapter')\r\n    .css({ left: percentThrough })\r\n    .appendTo(this.$('.BRnavline'))\r\n    .on(\"mouseenter\", event => {\r\n      // remove hover effect from other markers then turn on just for this\r\n      const marker = event.currentTarget;\r\n      const tooltip = marker.querySelector('div');\r\n      const tooltipOffset = tooltip.getBoundingClientRect();\r\n      const targetOffset = marker.getBoundingClientRect();\r\n      const boxSizeAdjust = parseInt(getComputedStyle(tooltip).paddingLeft) * 2;\r\n      if (tooltipOffset.x - boxSizeAdjust < 0) {\r\n        tooltip.style.setProperty('transform', `translateX(-${targetOffset.left - boxSizeAdjust}px)`);\r\n      }\r\n      this.$('.BRsearch,.BRchapter').removeClass('front');\r\n      $(event.target).addClass('front');\r\n    })\r\n    .on(\"mouseleave\", event => $(event.target).removeClass('front'))\r\n    .on('click', () => {\r\n      this._chaptersUpdateCurrent(tocEntry.pageIndex);\r\n      this.jumpToIndex(tocEntry.pageIndex);\r\n    });\r\n\r\n  this.$('.BRchapter, .BRsearch').each((i, el) => {\r\n    const $el = $(el);\r\n    $el\r\n      .on(\"mouseenter\", () => $el.addClass('front'))\r\n      .on(\"mouseleave\", () => $el.removeClass('front'));\r\n  });\r\n};\r\n\r\n/**\r\n * This makes a call to OL API and calls the given callback function with the\r\n * response from the API.\r\n *\r\n * @param {string} olHost\r\n * @param {string} ocaid\r\n */\r\nBookReader.prototype.getOpenLibraryRecord = async function (olHost, ocaid) {\r\n  // Try looking up by ocaid first, then by source_record\r\n  const baseURL = `${olHost}/query.json?type=/type/edition&*=`;\r\n  const fetchUrlByBookId = `${baseURL}&ocaid=${ocaid}`;\r\n\r\n  let data = await $.ajax({ url: fetchUrlByBookId, dataType: 'jsonp' });\r\n\r\n  if (!data || !data.length) {\r\n    // try sourceid\r\n    data = await $.ajax({ url: `${baseURL}&source_records=ia:${ocaid}`, dataType: 'jsonp' });\r\n  }\r\n\r\n  return data?.[0];\r\n};\r\n\r\n/**\r\n * @private\r\n * Highlights the current chapter based on current page\r\n * @param {PageIndex} curIndex\r\n */\r\nBookReader.prototype._chaptersUpdateCurrent = function(\r\n  curIndex = (this.mode == 2 ? Math.max(...this.displayedIndices) : this.firstIndex)\r\n) {\r\n  const tocEntriesIndexed = this._tocEntries.filter((el) => el.pageIndex != undefined).reverse();\r\n  const currChapter = tocEntriesIndexed[\r\n    // subtract one so that 2up shows the right label\r\n    tocEntriesIndexed.findIndex((chapter) => chapter.pageIndex <= curIndex)\r\n  ];\r\n  if (this._chaptersPanel) {\r\n    this._chaptersPanel.currentChapter = currChapter;\r\n  }\r\n};\r\n\r\n@customElement('br-chapters-panel')\r\nexport class BRChaptersPanel extends LitElement {\r\n  /** @type {TocEntry[]} */\r\n  @property({ type: Array })\r\n  contents = [];\r\n\r\n  /** @type {TocEntry?} */\r\n  @property({ type: Object })\r\n  currentChapter = {};\r\n\r\n  /** @type {(pageIndex: PageIndex) => void} */\r\n  jumpToPage = () => {};\r\n\r\n  /**\r\n   * @param {TocEntry[]} contents\r\n   */\r\n  constructor(contents) {\r\n    super();\r\n    this.contents = contents;\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n    <ol>\r\n      ${this.contents.map(tocEntry => this.renderTOCEntry(tocEntry))}\r\n    </ol>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * @param {TocEntry} tocEntry\r\n   */\r\n  renderTOCEntry(tocEntry) {\r\n    const chapterTitle = [tocEntry.label, tocEntry.title]\r\n      .filter(x => x)\r\n      .join(' ');\r\n    const clickable = tocEntry.pageIndex != undefined;\r\n    // note the click-tracking won't work...\r\n    return html`\r\n    <li\r\n      class=\"\r\n        BRtable-contents-el\r\n        ${clickable ? 'clickable' : ''}\r\n        ${tocEntry == this.currentChapter ? 'current' : ''}\r\n      \"\r\n      style=\"${styleMap({marginLeft: (tocEntry.level - 1) * 10 + 'px'})}\"\r\n      data-event-click-tracking=\"${ifDefined(clickable ? \"BRTOCPanel|GoToChapter\" : undefined)}\"\r\n      @click=\"${() => this.jumpToPage(tocEntry.pageIndex)}\"\r\n    >\r\n      ${chapterTitle}\r\n      ${tocEntry.pagenum ? html`\r\n        <br />\r\n        <span class=\"BRTOCElementPage\">Pagggge ${tocEntry.pagenum}</span>\r\n      ` : nothing}\r\n    </li>`;\r\n  }\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    this.dispatchEvent(new CustomEvent('connected'));\r\n  }\r\n\r\n  updated(changedProperties) {\r\n    if (changedProperties.has('currentChapter')) {\r\n      this.shadowRoot.querySelector('li.current')?.scrollIntoView({\r\n        block: 'nearest',\r\n        behavior: 'smooth',\r\n      });\r\n    }\r\n  }\r\n\r\n  static get styles() {\r\n    return css`\r\n      ol {\r\n        padding: 0;\r\n        margin: 0;\r\n        margin-right: 5px;\r\n      }\r\n      li {\r\n        padding: 10px;\r\n        overflow: hidden;\r\n        border-radius: 4px;\r\n      }\r\n      li.clickable {\r\n        font-weight: normal;\r\n        cursor: pointer;\r\n        transition: background-color 0.2s;\r\n      }\r\n\r\n      li.clickable:not(.current):hover {\r\n        background-color: rgba(255,255,255, 0.05);\r\n      }\r\n\r\n      li.current {\r\n        background-color: rgba(255,255,255,0.9);\r\n        color: #333;\r\n      }\r\n\r\n      .BRTOCElementPage {\r\n        font-size: 0.85em;\r\n        opacity: .8;\r\n      }`;\r\n  }\r\n}\r\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {nothing} from '../lit-html.js';\n\n/**\n * For AttributeParts, sets the attribute if the value is defined and removes\n * the attribute if the value is undefined.\n *\n * For other part types, this directive is a no-op.\n */\nexport const ifDefined = <T>(value: T) => value ?? nothing;\n"],"names":["css","html","LitElement","nothing","customElement","property","ifDefined","styleMap","BookReader","prototype","init","super_","call","options","enableChaptersPlugin","ui","_chapterInit","rawTableOfContents","table_of_contents","length","_tocEntries","_chaptersRender","shell","menuProviders","id","icon","label","component","pageIndex","_chaptersUpdateCurrent","jumpToIndex","e","_chaptersPanel","target","addMenuShortcut","updateMenuContents","forEach","tocEntry","i","_chaptersRenderMarker","entryIndex","undefined","chapterStr","title","filter","x","join","percentThrough","util","cssPercentage","book","getNumLeafs","$","append","text","getPageName","addClass","left","appendTo","on","event","marker","currentTarget","tooltip","querySelector","tooltipOffset","getBoundingClientRect","targetOffset","boxSizeAdjust","parseInt","getComputedStyle","paddingLeft","style","setProperty","removeClass","each","el","$el","getOpenLibraryRecord","olHost","ocaid","baseURL","fetchUrlByBookId","data","ajax","url","dataType","curIndex","mode","Math","max","displayedIndices","firstIndex","tocEntriesIndexed","reverse","currChapter","findIndex","chapter","currentChapter","BRChaptersPanel","_decorate","_initialize","_LitElement","constructor","contents","F","d","kind","decorators","type","Array","key","value","Object","render","map","renderTOCEntry","chapterTitle","clickable","marginLeft","level","jumpToPage","pagenum","connectedCallback","_get","_getPrototypeOf","dispatchEvent","CustomEvent","updated","changedProperties","has","shadowRoot","scrollIntoView","block","behavior","static","styles"],"sourceRoot":""}