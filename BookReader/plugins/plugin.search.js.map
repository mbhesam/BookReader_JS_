{"version":3,"file":"plugins/plugin.search.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./src/plugins/search/plugin.search.js","webpack://@internetarchive/bookreader/./src/plugins/search/utils.js","webpack://@internetarchive/bookreader/./src/plugins/search/view.js"],"sourcesContent":["// @ts-check\r\n/* global BookReader */\r\n/**\r\n * Plugin for Archive.org book search\r\n * Events fired at various points throughout search processing are published\r\n * on the document DOM element. These can be subscribed to using jQuery's event\r\n * binding method `$.fn.on`. All of the events are prefixed with a BookReader\r\n * namespace. The events are:\r\n *\r\n * @event BookReader:SearchStarted - When a search form is submitted, immediately\r\n *   before an AJAX call is made to request search results\r\n * @event BookReader:SearchCallback - When the search AJAX call is returned and at\r\n *   least one result is returned. The event callback receives an object\r\n *   with the `results`, plugin `options`, and the BookReader `instance`\r\n * @event BookReader:SearchCallbackError - When the AJAX request returns an error.\r\n *   Receives the `results` and `instance`\r\n * @event BookReader:SearchCallbackNotIndexed - When a message is received that\r\n *   the book has not had OCR text indexed yet. Receives `instance`\r\n * @event BookReader:SearchCallbackEmpty - When no results found. Receives\r\n *   `instance`\r\n * @event BookReader:SearchCanceled - When no results found. Receives\r\n *   `instance`\r\n */\r\nimport { poll } from '../../BookReader/utils.js';\r\nimport { renderBoxesInPageContainerLayer } from '../../BookReader/PageContainer.js';\r\nimport SearchView from './view.js';\r\nimport { marshallSearchResults } from './utils.js';\r\n/** @typedef {import('../../BookReader/PageContainer').PageContainer} PageContainer */\r\n/** @typedef {import('../../BookReader/BookModel').PageIndex} PageIndex */\r\n/** @typedef {import('../../BookReader/BookModel').LeafNum} LeafNum */\r\n/** @typedef {import('../../BookReader/BookModel').PageNumString} PageNumString */\r\n\r\njQuery.extend(BookReader.defaultOptions, {\r\n  server: 'ia600609.us.archive.org',\r\n  bookId: '',\r\n  subPrefix: '',\r\n  bookPath: '',\r\n  enableSearch: true,\r\n  searchInsideProtocol: 'https',\r\n  searchInsideUrl: '/fulltext/inside.php',\r\n  searchInsidePreTag: '{{{',\r\n  searchInsidePostTag: '}}}',\r\n  initialSearchTerm: null,\r\n});\r\n\r\n/** @override */\r\nBookReader.prototype.setup = (function (super_) {\r\n  return function (options) {\r\n    super_.call(this, options);\r\n\r\n    this.searchTerm = '';\r\n    this.searchResults = null;\r\n    this.searchInsideUrl = options.searchInsideUrl;\r\n    this.enableSearch = options.enableSearch;\r\n\r\n    // Base server used by some api calls\r\n    this.bookId = options.bookId;\r\n    this.server = options.server;\r\n    this.subPrefix = options.subPrefix;\r\n    this.bookPath = options.bookPath;\r\n\r\n    this.searchXHR = null;\r\n    this._cancelSearch.bind(this);\r\n    this.cancelSearchRequest.bind(this);\r\n\r\n    /** @type { {[pageIndex: number]: SearchInsideMatchBox[]} } */\r\n    this._searchBoxesByIndex = {};\r\n\r\n    this.searchView = undefined;\r\n  };\r\n})(BookReader.prototype.setup);\r\n\r\n/** @override */\r\nBookReader.prototype.init = (function (super_) {\r\n  return function () {\r\n    super_.call(this);\r\n    // give SearchView the most complete bookreader state\r\n    this.searchView = new SearchView({\r\n      br: this,\r\n      searchCancelledCallback: () => {\r\n        this._cancelSearch();\r\n        this.trigger('SearchCanceled', { term: this.searchTerm, instance: this });\r\n      }\r\n    });\r\n    if (this.options.enableSearch && this.options.initialSearchTerm) {\r\n      /**\r\n       * this.search() take two parameter\r\n       * 1. this.options.initialSearchTerm - search term\r\n       * 2. {\r\n       *  goToFirstResult: this.options.goToFirstResult,\r\n       *  suppressFragmentChange: false // always want to change fragment in URL\r\n       * }\r\n       */\r\n      this.search(\r\n        this.options.initialSearchTerm,\r\n        { goToFirstResult: this.options.goToFirstResult, suppressFragmentChange: false }\r\n      );\r\n    }\r\n  };\r\n})(BookReader.prototype.init);\r\n\r\n/** @override */\r\nBookReader.prototype.buildToolbarElement = (function (super_) {\r\n  return function () {\r\n    const $el = super_.call(this);\r\n    if (!this.enableSearch) { return; }\r\n    if (this.searchView.dom.toolbarSearch) {\r\n      $el.find('.BRtoolbarSectionInfo').after(this.searchView.dom.toolbarSearch);\r\n    }\r\n    return $el;\r\n  };\r\n})(BookReader.prototype.buildToolbarElement);\r\n\r\n/** @override */\r\nBookReader.prototype._createPageContainer = (function (super_) {\r\n  return function (index) {\r\n    const pageContainer = super_.call(this, index);\r\n    if (this.enableSearch && pageContainer.page && index in this._searchBoxesByIndex) {\r\n      const pageIndex = pageContainer.page.index;\r\n      const boxes = this._searchBoxesByIndex[pageIndex];\r\n      renderBoxesInPageContainerLayer(\r\n        'searchHiliteLayer',\r\n        boxes,\r\n        pageContainer.page,\r\n        pageContainer.$container[0],\r\n        boxes.map(b => `match-index-${b.matchIndex}`),\r\n      );\r\n    }\r\n    return pageContainer;\r\n  };\r\n})(BookReader.prototype._createPageContainer);\r\n\r\n/**\r\n * @typedef {object} SearchOptions\r\n * @property {boolean} goToFirstResult\r\n * @property {boolean} disablePopup\r\n * @property {(null|function)} error - @deprecated at v.5.0\r\n * @property {(null|function)} success - @deprecated at v.5.0\r\n */\r\n\r\n/**\r\n * Submits search request\r\n *\r\n * @param {string} term\r\n * @param {SearchOptions} overrides\r\n */\r\nBookReader.prototype.search = async function(term = '', overrides = {}) {\r\n  /** @type {SearchOptions} */\r\n  const defaultOptions = {\r\n    goToFirstResult: false, /* jump to the first result (default=false) */\r\n    disablePopup: false,    /* don't show the modal progress (default=false) */\r\n    suppressFragmentChange: false, /* don't change the URL on initial load */\r\n    error: null,            /* optional error handler (default=null) */\r\n    success: null,          /* optional success handler (default=null) */\r\n\r\n  };\r\n  const options = jQuery.extend({}, defaultOptions, overrides);\r\n  this.suppressFragmentChange = options.suppressFragmentChange;\r\n  this.searchCancelled = false;\r\n\r\n  // strip slashes, since this goes in the url\r\n  this.searchTerm = term.replace(/\\//g, ' ');\r\n\r\n  if (!options.suppressFragmentChange) {\r\n    this.trigger(BookReader.eventNames.fragmentChange);\r\n  }\r\n\r\n  // Add quotes to the term. This is to compenstate for the backends default OR query\r\n  // term = term.replace(/['\"]+/g, '');\r\n  // term = '\"' + term + '\"';\r\n\r\n  // Remove the port and userdir\r\n  const serverPath = this.server.replace(/:.+/, '');\r\n  const baseUrl = `${this.options.searchInsideProtocol}://${serverPath}${this.searchInsideUrl}?`;\r\n\r\n  // Remove subPrefix from end of path\r\n  let path = this.bookPath;\r\n  const subPrefixWithSlash = `/${this.subPrefix}`;\r\n  if (this.bookPath.length - this.bookPath.lastIndexOf(subPrefixWithSlash) == subPrefixWithSlash.length) {\r\n    path = this.bookPath.substr(0, this.bookPath.length - subPrefixWithSlash.length);\r\n  }\r\n\r\n  const urlParams = {\r\n    item_id: this.bookId,\r\n    doc: this.subPrefix,\r\n    path,\r\n    q: term,\r\n    pre_tag: this.options.searchInsidePreTag,\r\n    post_tag: this.options.searchInsidePostTag,\r\n  };\r\n\r\n  // NOTE that the API does not expect / (slashes) to be encoded. (%2F) won't work\r\n  const paramStr = $.param(urlParams).replace(/%2F/g, '/');\r\n\r\n  const url = `${baseUrl}${paramStr}`;\r\n\r\n  const callSearchResultsCallback = (searchInsideResults) => {\r\n    if (this.searchCancelled) {\r\n      return;\r\n    }\r\n    const responseHasError = searchInsideResults.error || !searchInsideResults.matches.length;\r\n    const hasCustomError = typeof options.error === 'function';\r\n    const hasCustomSuccess = typeof options.success === 'function';\r\n\r\n    if (responseHasError) {\r\n      console.error('Search Inside Response Error', searchInsideResults.error || 'matches.length == 0');\r\n      hasCustomError\r\n        ? options.error.call(this, searchInsideResults, options)\r\n        : this.BRSearchCallbackError(searchInsideResults, options);\r\n    } else {\r\n      hasCustomSuccess\r\n        ? options.success.call(this, searchInsideResults, options)\r\n        : this.BRSearchCallback(searchInsideResults, options);\r\n    }\r\n  };\r\n\r\n  this.trigger('SearchStarted', { term: this.searchTerm, instance: this });\r\n  callSearchResultsCallback(await $.ajax({\r\n    url: url,\r\n    dataType: 'jsonp',\r\n    cache: true,\r\n    beforeSend: xhr => { this.searchXHR = xhr; },\r\n  }));\r\n};\r\n\r\n/**\r\n * cancels AJAX Call\r\n * emits custom event\r\n */\r\nBookReader.prototype._cancelSearch = function () {\r\n  this.searchXHR?.abort();\r\n  this.searchView.clearSearchFieldAndResults(false);\r\n  this.searchTerm = '';\r\n  this.searchXHR = null;\r\n  this.searchCancelled = true;\r\n  this.searchResults = [];\r\n};\r\n\r\n/**\r\n * External function to cancel search\r\n * checks for term & xhr in flight before running\r\n */\r\nBookReader.prototype.cancelSearchRequest = function () {\r\n  this.searchCancelled = true;\r\n  if (this.searchXHR !== null) {\r\n    this._cancelSearch();\r\n    this.searchView.toggleSearchPending();\r\n    this.trigger('SearchCanceled', { term: this.searchTerm, instance: this });\r\n  }\r\n};\r\n\r\n/**\r\n  * @typedef {object} SearchInsideMatchBox\r\n  * @property {number} page\r\n  * @property {number} r\r\n  * @property {number} l\r\n  * @property {number} b\r\n  * @property {number} t\r\n  * @property {HTMLDivElement} [div]\r\n  * @property {number} matchIndex This is a fake field! not part of the API response. The index of the match that contains this box in total search results matches.\r\n  */\r\n\r\n/**\r\n * @typedef {object} SearchInsideMatch\r\n * @property {number} matchIndex This is a fake field! Not part of the API response. It is added by the JS.\r\n * @property {string} displayPageNumber (fake field) The page number as it should be displayed in the UI.\r\n * @property {string} html (computed field) The html-escaped raw html to display in the UI.\r\n * @property {string} text\r\n * @property {Array<{ page: number, boxes: SearchInsideMatchBox[] }>} par\r\n */\r\n\r\n/**\r\n * @typedef {object} SearchInsideResults\r\n * @property {string} error\r\n * @property {SearchInsideMatch[]} matches\r\n * @property {boolean} indexed\r\n */\r\n\r\n/**\r\n * Search Results return handler\r\n * @param {SearchInsideResults} results\r\n * @param {object} options\r\n * @param {boolean} options.goToFirstResult\r\n */\r\nBookReader.prototype.BRSearchCallback = function(results, options) {\r\n  marshallSearchResults(\r\n    results,\r\n    pageNum => this.book.getPageNum(this.book.leafNumToIndex(pageNum)),\r\n    this.options.searchInsidePreTag,\r\n    this.options.searchInsidePostTag,\r\n  );\r\n  this.searchResults = results || [];\r\n\r\n  this.updateSearchHilites();\r\n  this.removeProgressPopup();\r\n  if (options.goToFirstResult) {\r\n    this._searchPluginGoToResult(0);\r\n  }\r\n  this.trigger('SearchCallback', { results, options, instance: this });\r\n};\r\n\r\n/**\r\n * Main search results error handler\r\n * @callback\r\n * @param {SearchInsideResults} results\r\n */\r\nBookReader.prototype.BRSearchCallbackError = function(results) {\r\n  this._BRSearchCallbackError(results);\r\n};\r\n\r\n/**\r\n * @private draws search results error\r\n * @callback\r\n * @param {SearchInsideResults} results\r\n * @param {jQuery} $el\r\n * @param {boolean} fade\r\n */\r\nBookReader.prototype._BRSearchCallbackError = function(results) {\r\n  this.searchResults = results;\r\n  const basePayload = {\r\n    term: this.searchTerm,\r\n    instance: this,\r\n  };\r\n  if (results.error) {\r\n    const payload = Object.assign({}, basePayload, { results });\r\n    this.trigger('SearchCallbackError', payload);\r\n  } else if (0 == results.matches.length) {\r\n    if (false === results.indexed) {\r\n      this.trigger('SearchCallbackBookNotIndexed', basePayload);\r\n      return;\r\n    }\r\n    this.trigger('SearchCallbackEmpty', basePayload);\r\n  }\r\n};\r\n\r\n/**\r\n * updates search on-page highlights controller\r\n */\r\nBookReader.prototype.updateSearchHilites = function() {\r\n  /** @type {SearchInsideMatch[]} */\r\n  const matches = this.searchResults?.matches || [];\r\n  /** @type { {[pageIndex: number]: SearchInsideMatchBox[]} } */\r\n  const boxesByIndex = {};\r\n\r\n  // Clear any existing svg layers\r\n  this.removeSearchHilites();\r\n\r\n  // Group by pageIndex\r\n  for (const match of matches) {\r\n    for (const box of match.par[0].boxes) {\r\n      const pageIndex = this.book.leafNumToIndex(box.page);\r\n      const pageBoxes = boxesByIndex[pageIndex] || (boxesByIndex[pageIndex] = []);\r\n      pageBoxes.push(box);\r\n    }\r\n  }\r\n\r\n  // update any already created pages\r\n  for (const [pageIndexString, boxes] of Object.entries(boxesByIndex)) {\r\n    const pageIndex = parseFloat(pageIndexString);\r\n    const page = this.book.getPage(pageIndex);\r\n    const pageContainers = this.getActivePageContainerElementsForIndex(pageIndex);\r\n    for (const container of pageContainers) {\r\n      renderBoxesInPageContainerLayer('searchHiliteLayer', boxes, page, container, boxes.map(b => `match-index-${b.matchIndex}`));\r\n    }\r\n  }\r\n\r\n  this._searchBoxesByIndex = boxesByIndex;\r\n};\r\n\r\n/**\r\n * remove search highlights\r\n */\r\nBookReader.prototype.removeSearchHilites = function() {\r\n  $(this.getActivePageContainerElements()).find('.searchHiliteLayer').remove();\r\n};\r\n\r\n/**\r\n * @private\r\n * Goes to the page specified. If the page is not viewable, tries to load the page\r\n * FIXME Most of this logic is IA specific, and should be less integrated into here\r\n * or at least more configurable.\r\n * @param {number} matchIndex\r\n */\r\nBookReader.prototype._searchPluginGoToResult = async function (matchIndex) {\r\n  const match = this.searchResults?.matches[matchIndex];\r\n  const book = this.book;\r\n  const pageIndex = book.leafNumToIndex(match.par[0].page);\r\n  const page = book.getPage(pageIndex);\r\n  const onNearbyPage = Math.abs(this.currentIndex() - pageIndex) < 3;\r\n  let makeUnviewableAtEnd = false;\r\n  if (!page.isViewable) {\r\n    const resp = await fetch('/services/bookreader/request_page?' + new URLSearchParams({\r\n      id: this.options.bookId,\r\n      subprefix: this.options.subPrefix,\r\n      leafNum: page.leafNum,\r\n    })).then(r => r.json());\r\n\r\n    for (const leafNum of resp.value) {\r\n      book.getPage(book.leafNumToIndex(leafNum)).makeViewable();\r\n    }\r\n\r\n    // not able to show page; make the page viewable anyways so that it can\r\n    // actually open. On IA, it has a fallback to a special error page.\r\n    if (!resp.value.length) {\r\n      book.getPage(pageIndex).makeViewable();\r\n      makeUnviewableAtEnd = true;\r\n    }\r\n\r\n    // Trigger an update of book\r\n    this._modes.mode1Up.mode1UpLit.updatePages();\r\n    if (this.activeMode == this._modes.mode1Up) {\r\n      await this._modes.mode1Up.mode1UpLit.updateComplete;\r\n    }\r\n  }\r\n  /* this updates the URL */\r\n  if (!this._isIndexDisplayed(pageIndex)) {\r\n    this.suppressFragmentChange = false;\r\n    this.jumpToIndex(pageIndex);\r\n  }\r\n\r\n  // Reset it to unviewable if it wasn't resolved\r\n  if (makeUnviewableAtEnd) {\r\n    book.getPage(pageIndex).makeViewable(false);\r\n  }\r\n\r\n  // Scroll/flash in the ui\r\n  const $boxes = await poll(() => $(`rect.match-index-${match.matchIndex}`), { until: result => result.length > 0 });\r\n  if ($boxes.length) {\r\n    $boxes.css('animation', 'none');\r\n    $boxes[0].scrollIntoView({\r\n      // Only vertically center the highlight if we're in 1up or in full screen. In\r\n      // 2up, if we're not fullscreen, the whole body gets scrolled around to try to\r\n      // center the highlight 🙄 See:\r\n      // https://stackoverflow.com/questions/11039885/scrollintoview-causing-the-whole-page-to-move/11041376\r\n      // Note: nearest doesn't quite work great, because the ReadAloud toolbar is now\r\n      // full-width, and covers up the last line of the highlight.\r\n      block: this.constMode1up == this.mode || this.isFullscreenActive ? 'center' : 'nearest',\r\n      inline: 'center',\r\n      behavior: onNearbyPage ? 'smooth' : 'auto',\r\n    });\r\n    // wait for animation to start\r\n    await new Promise(resolve => setTimeout(resolve, 100));\r\n    $boxes.removeAttr(\"style\");\r\n  }\r\n};\r\n\r\n/**\r\n * Removes all search pins\r\n */\r\nBookReader.prototype.removeSearchResults = function(suppressFragmentChange = false) {\r\n  this.removeSearchHilites(); //be sure to set all box.divs to null\r\n  this.searchTerm = null;\r\n  this.searchResults = null;\r\n  if (!suppressFragmentChange) {\r\n    this.trigger(BookReader.eventNames.fragmentChange);\r\n  }\r\n};\r\n\r\n/**\r\n * Returns true if a search highlight is currently being displayed\r\n * @returns {boolean}\r\n */\r\nBookReader.prototype.searchHighlightVisible = function() {\r\n  const results = this.searchResults;\r\n  let visiblePages = [];\r\n  if (null == results) return false;\r\n\r\n  if (this.constMode2up == this.mode) {\r\n    visiblePages = [this.twoPage.currentIndexL, this.twoPage.currentIndexR];\r\n  } else if (this.constMode1up == this.mode) {\r\n    visiblePages = [this.currentIndex()];\r\n  } else {\r\n    return false;\r\n  }\r\n\r\n  results.matches.some(match => {\r\n    return match.par[0].boxes.some(box => {\r\n      const pageIndex = this.book.leafNumToIndex(box.page);\r\n      if (jQuery.inArray(pageIndex, visiblePages) >= 0) {\r\n        return true;\r\n      }\r\n    });\r\n  });\r\n\r\n  return false;\r\n};\r\n","import { escapeHTML, escapeRegExp } from '../../BookReader/utils.js';\r\n\r\n/**\r\n * @param {string} match\r\n * @param {string} preTag\r\n * @param {string} postTag\r\n * @returns {string}\r\n */\r\nexport function renderMatch(match, preTag, postTag) {\r\n  // Search results are returned as a text blob with the hits wrapped in\r\n  // triple mustaches. Hits occasionally include text beyond the search\r\n  // term, so everything within the staches is captured and wrapped.\r\n  const preTagRe = escapeRegExp(escapeHTML(preTag));\r\n  const postTagRe = escapeRegExp(escapeHTML(postTag));\r\n  // [^] matches any character, including line breaks\r\n  const regex = new RegExp(`${preTagRe}([^]+?)${postTagRe}`, 'g');\r\n  return escapeHTML(match)\r\n    .replace(regex, '<mark>$1</mark>')\r\n    // Fix trailing hyphens. This over-corrects but is net useful.\r\n    .replace(/(\\b)- /g, '$1');\r\n}\r\n\r\n/**\r\n * Attach some fields to search inside results\r\n * @param {SearchInsideResults} results\r\n * @param {(pageNum: LeafNum) => PageNumString} displayPageNumberFn\r\n * @param {string} preTag\r\n * @param {string} postTag\r\n */\r\nexport function marshallSearchResults(results, displayPageNumberFn, preTag, postTag) {\r\n  // Attach matchIndex to a few things to make it easier to identify\r\n  // an active/selected match\r\n  for (const [index, match] of results.matches.entries()) {\r\n    match.matchIndex = index;\r\n    match.displayPageNumber = displayPageNumberFn(match.par[0].page);\r\n    match.html = renderMatch(match.text, preTag, postTag);\r\n    for (const par of match.par) {\r\n      for (const box of par.boxes) {\r\n        box.matchIndex = index;\r\n      }\r\n    }\r\n  }\r\n}\r\n","class SearchView {\r\n  /**\r\n   * @param {object} params\r\n   * @param {object} params.br The BookReader instance\r\n   * @param {function} params.cancelSearch callback when a user wants to cancel search\r\n   *\r\n   * @event BookReader:SearchResultsCleared - when the search results nav gets cleared\r\n   * @event BookReader:ToggleSearchMenu - when search results menu should toggle\r\n   */\r\n  constructor({ br, searchCancelledCallback = () => {} }) {\r\n    this.br = br;\r\n    this.matches = [];\r\n    this.cacheDOMElements();\r\n    this.bindEvents();\r\n    this.cancelSearch = searchCancelledCallback;\r\n  }\r\n\r\n  cacheDOMElements() {\r\n    this.dom = {};\r\n    // Search input within the top toolbar. Will be removed once the mobile menu is replaced.\r\n    this.dom.toolbarSearch = this.buildToolbarSearch();\r\n  }\r\n\r\n  /**\r\n   * @param {string} query\r\n   */\r\n  setQuery(query) {\r\n    this.br.$('[name=\"query\"]').val(query);\r\n  }\r\n\r\n  emptyMatches() {\r\n    this.matches = [];\r\n  }\r\n\r\n  removeResultPins() {\r\n    this.br.$('.BRnavpos .BRsearch').remove();\r\n  }\r\n\r\n  clearSearchFieldAndResults(dispatchEventWhenComplete = true) {\r\n    this.br.removeSearchResults();\r\n    this.removeResultPins();\r\n    this.emptyMatches();\r\n    this.setQuery('');\r\n    this.teardownSearchNavigation();\r\n    if (dispatchEventWhenComplete) {\r\n      this.br.trigger('SearchResultsCleared');\r\n    }\r\n  }\r\n\r\n  toggleSidebar() {\r\n    this.br.trigger('ToggleSearchMenu');\r\n  }\r\n\r\n  renderSearchNavigation() {\r\n    const selector = 'BRsearch-navigation';\r\n    $('.BRnav').before(`\r\n      <div class=\"${selector}\">\r\n        <button class=\"toggle-sidebar\">\r\n          <h4>\r\n            <span class=\"icon icon-search\"></span> Results\r\n          </h4>\r\n        </button>\r\n        <div class=\"pagination\">\r\n          <button class=\"prev\" title=\"Previous result\"><span class=\"icon icon-chevron hflip\"></span></button>\r\n          <span data-id=\"resultsCount\">${this.resultsPosition()}</span>\r\n          <button class=\"next\" title=\"Next result\"><span class=\"icon icon-chevron\"></button>\r\n        </div>\r\n        <button class=\"clear\" title=\"Clear search results\">\r\n          <span class=\"icon icon-close\"></span>\r\n        </button>\r\n      </div>\r\n    `);\r\n    this.dom.searchNavigation = $(`.${selector}`);\r\n  }\r\n\r\n  resultsPosition() {\r\n    let positionMessage = `${this.matches.length} result${this.matches.length === 1 ? '' : 's'}`;\r\n    if (~this.currentMatchIndex) {\r\n      positionMessage = `${this.currentMatchIndex + 1} / ${this.matches.length}`;\r\n    }\r\n    return positionMessage;\r\n  }\r\n\r\n  bindSearchNavigationEvents() {\r\n    if (!this.dom.searchNavigation) { return; }\r\n    const namespace = 'searchNavigation';\r\n\r\n    this.dom.searchNavigation\r\n      .on(`click.${namespace}`, '.clear', this.clearSearchFieldAndResults.bind(this))\r\n      .on(`click.${namespace}`, '.prev', this.showPrevResult.bind(this))\r\n      .on(`click.${namespace}`, '.next', this.showNextResult.bind(this))\r\n      .on(`click.${namespace}`, '.toggle-sidebar', this.toggleSidebar.bind(this))\r\n      .on(`click.${namespace}`, false);\r\n  }\r\n\r\n  showPrevResult() {\r\n    if (this.currentMatchIndex === 0) { return; }\r\n    if (this.br.mode === this.br.constModeThumb) { this.br.switchMode(this.br.constMode1up); }\r\n    if (!~this.currentMatchIndex) {\r\n      this.currentMatchIndex = this.getClosestMatchIndex((start, end, comparator) => end[0] > comparator) + 1;\r\n    }\r\n    this.br.$('.BRnavline .BRsearch').eq(--this.currentMatchIndex).click();\r\n    this.updateResultsPosition();\r\n    this.updateSearchNavigationButtons();\r\n  }\r\n\r\n  showNextResult() {\r\n    if (this.currentMatchIndex + 1 === this.matches.length) { return; }\r\n    if (this.br.mode === this.br.constModeThumb) { this.br.switchMode(this.br.constMode1up); }\r\n    if (!~this.currentMatchIndex) {\r\n      this.currentMatchIndex = this.getClosestMatchIndex((start, end, comparator) => start[start.length - 1] > comparator) - 1;\r\n    }\r\n    this.br.$('.BRnavline .BRsearch').eq(++this.currentMatchIndex).click();\r\n    this.updateResultsPosition();\r\n    this.updateSearchNavigationButtons();\r\n  }\r\n\r\n  /**\r\n   * Obtains closest match based on the logical comparison function passed in.\r\n   * When the comparison function returns true, the starting (left) half of the\r\n   * matches array is used in the binary split, else the ending (right) half is\r\n   * used. A recursive call is made to perform the same split and comparison\r\n   * on the winning half of the matches. This is traditionally known as binary\r\n   * search (https://en.wikipedia.org/wiki/Binary_search_algorithm), and in\r\n   * most cases (medium to large search result arrays) should outperform\r\n   * traversing the array from start to finish. In the case of small arrays,\r\n   * the speed difference is negligible.\r\n   *\r\n   * @param {function} comparisonFn\r\n   * @return {number} matchIndex\r\n   */\r\n  getClosestMatchIndex(comparisonFn) {\r\n    const matchPages = this.matches.map((m) => m.par[0].page);\r\n    const currentPage = this.br.currentIndex() + 1;\r\n    const closestTo = (pool, comparator) => {\r\n      if (pool.length === 1) { return pool[0]; }\r\n      const start = pool.slice(0, pool.length / 2);\r\n      const end = pool.slice(pool.length / 2);\r\n      return closestTo((comparisonFn(start, end, comparator) ? start : end), comparator);\r\n    };\r\n\r\n    const closestPage = closestTo(matchPages, currentPage);\r\n    return this.matches.indexOf(this.matches.find((m) => m.par[0].page === closestPage));\r\n  }\r\n\r\n  updateResultsPosition() {\r\n    if (!this.dom.searchNavigation) return;\r\n    this.dom.searchNavigation.find('[data-id=resultsCount]').text(this.resultsPosition());\r\n  }\r\n\r\n  updateSearchNavigationButtons() {\r\n    if (!this.dom.searchNavigation) return;\r\n    this.dom.searchNavigation.find('.prev').attr('disabled', !this.currentMatchIndex);\r\n    this.dom.searchNavigation.find('.next').attr('disabled', this.currentMatchIndex + 1 === this.matches.length);\r\n  }\r\n\r\n  teardownSearchNavigation() {\r\n    if (!this.dom.searchNavigation) {\r\n      this.dom.searchNavigation = $('.BRsearch-navigation');\r\n    }\r\n    if (!this.dom.searchNavigation.length) { return; }\r\n\r\n    this.dom.searchNavigation.off('.searchNavigation').remove();\r\n    this.dom.searchNavigation = null;\r\n    this.br.resize();\r\n  }\r\n\r\n  setCurrentMatchIndex() {\r\n    let matchingSearchResult;\r\n    if (this.br.mode === this.br.constModeThumb) {\r\n      this.currentMatchIndex = -1;\r\n      return;\r\n    }\r\n    if (this.br.mode === this.br.constMode2up) {\r\n      matchingSearchResult = this.find2upMatchingSearchResult();\r\n    }\r\n    else {\r\n      matchingSearchResult = this.find1upMatchingSearchResult();\r\n    }\r\n    this.currentMatchIndex = this.matches.indexOf(matchingSearchResult);\r\n  }\r\n\r\n  find1upMatchingSearchResult() {\r\n    return this.matches.find((m) => this.br.currentIndex() === m.par[0].page - 1);\r\n  }\r\n\r\n  find2upMatchingSearchResult() {\r\n    return this.matches.find((m) => this.br._isIndexDisplayed(m.par[0].page - 1));\r\n  }\r\n\r\n  updateSearchNavigation() {\r\n    if (!this.matches.length) { return; }\r\n\r\n    this.setCurrentMatchIndex();\r\n    this.updateResultsPosition();\r\n    this.updateSearchNavigationButtons();\r\n  }\r\n\r\n  /**\r\n   * @param {boolean} bool\r\n   */\r\n  togglePinsFor(bool) {\r\n    const pinsVisibleState = bool ? 'visible' : 'hidden';\r\n    this.br.refs.$BRfooter.find('.BRsearch').css({ visibility: pinsVisibleState });\r\n  }\r\n\r\n  buildToolbarSearch() {\r\n    const toolbarSearch = document.createElement('span');\r\n    toolbarSearch.classList.add('BRtoolbarSection', 'BRtoolbarSectionSearch');\r\n    toolbarSearch.innerHTML = `\r\n      <form class=\"BRbooksearch desktop\">\r\n        <input type=\"search\" name=\"query\" class=\"BRsearchInput\" value=\"\" placeholder=\"Search inside\"/>\r\n        <button type=\"submit\" class=\"BRsearchSubmit\">\r\n          <img src=\"${this.br.imagesBaseURL}icon_search_button.svg\" />\r\n        </button>\r\n      </form>\r\n    `;\r\n    return toolbarSearch;\r\n  }\r\n\r\n  /**\r\n   * @param {array} matches\r\n   */\r\n  renderPins(matches) {\r\n    matches.forEach((match) => {\r\n      const pageIndex = this.br.book.leafNumToIndex(match.par[0].page);\r\n      const uiStringSearch = \"Search result\"; // i18n\r\n      const percentThrough = this.br.constructor.util.cssPercentage(pageIndex, this.br.book.getNumLeafs() - 1);\r\n\r\n      let html = match.html;\r\n      if (html.length > 200) {\r\n        const start = Math.max(0, html.indexOf('<mark>') - 100);\r\n        if (start != 0) {\r\n          html = '…' + match.html\r\n            .substring(start)\r\n            // Make sure at word boundary though\r\n            .replace(/^\\S+/, '');\r\n        }\r\n      }\r\n      // draw marker\r\n      $('<div>')\r\n        .addClass('BRsearch')\r\n        .css({\r\n          left: percentThrough,\r\n        })\r\n        .attr('title', uiStringSearch)\r\n        .append(`\r\n          <div class=\"BRquery\">\r\n            <main>${html}</main>\r\n            <footer>Page ${match.displayPageNumber}</footer>\r\n          </div>\r\n        `)\r\n        .appendTo(this.br.$('.BRnavline'))\r\n        .on(\"mouseenter\", (event) => {\r\n          // remove from other markers then turn on just for this\r\n          // XXX should be done when nav slider moves\r\n          const marker = event.currentTarget;\r\n          const tooltip = marker.querySelector('.BRquery');\r\n          const tooltipOffset = tooltip.getBoundingClientRect();\r\n          const targetOffset = marker.getBoundingClientRect();\r\n          const boxSizeAdjust = parseInt(getComputedStyle(tooltip).paddingLeft) * 2;\r\n          if (tooltipOffset.x - boxSizeAdjust < 0) {\r\n            tooltip.style.setProperty('transform', `translateX(-${targetOffset.left - boxSizeAdjust}px)`);\r\n          }\r\n          $('.BRsearch,.BRchapter').removeClass('front');\r\n          $(event.target).addClass('front');\r\n        })\r\n        .on(\"mouseleave\", (event) => $(event.target).removeClass('front'))\r\n        .on(\"click\", () => { this.br._searchPluginGoToResult(match.matchIndex); });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {boolean} bool\r\n   */\r\n  toggleSearchPending(bool) {\r\n    if (bool) {\r\n      this.br.showProgressPopup(\"Search results will appear below...\", () => this.progressPopupClosed());\r\n    }\r\n    else {\r\n      this.br.removeProgressPopup();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Primary callback when user cancels search popup\r\n   */\r\n  progressPopupClosed() {\r\n    this.toggleSearchPending();\r\n    this.cancelSearch();\r\n  }\r\n\r\n  renderErrorModal(textIsProcessing = false) {\r\n    const errorDetails = `${!textIsProcessing ? 'The text may still be processing. ' : ''}Please try again.`;\r\n    this.renderModalMessage(`\r\n      Sorry, there was an error with your search.\r\n      <br />\r\n      ${errorDetails}\r\n    `);\r\n    this.delayModalRemovalFor(4000);\r\n  }\r\n\r\n  renderBookNotIndexedModal() {\r\n    this.renderModalMessage(`\r\n      <p>\r\n         This book hasn't been indexed for searching yet.\r\n         We've just started indexing it, so search should be available soon.\r\n         <br />\r\n         Please try again later. Thanks!\r\n      </p>\r\n    `);\r\n    this.delayModalRemovalFor(5000);\r\n  }\r\n\r\n  renderResultsEmptyModal() {\r\n    this.renderModalMessage('No matches were found.');\r\n    this.delayModalRemovalFor(2000);\r\n  }\r\n\r\n  /**\r\n   * @param {string} messageHTML The innerHTML string used to popupate the modal contents\r\n   */\r\n  renderModalMessage(messageHTML) {\r\n    const modal = document.createElement('div');\r\n    modal.classList.add('BRprogresspopup', 'search_modal');\r\n    modal.innerHTML = messageHTML;\r\n    document.querySelector(this.br.el).append(modal);\r\n  }\r\n\r\n  /**\r\n   * @param {number} timeoutMS\r\n   */\r\n  delayModalRemovalFor(timeoutMS) {\r\n    setTimeout(this.br.removeProgressPopup.bind(this.br), timeoutMS);\r\n  }\r\n\r\n  /**\r\n   * @param {Event} e\r\n   */\r\n  submitHandler(e) {\r\n    e.preventDefault();\r\n    const query = e.target.querySelector('[name=\"query\"]').value;\r\n    if (!query.length) { return false; }\r\n    this.br.search(query);\r\n    this.emptyMatches();\r\n    this.toggleSearchPending(true);\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @param {Event} e\r\n   * @param {object} properties\r\n   *   @param {object} properties.results\r\n   *   @param {object} properties.options\r\n   */\r\n  handleSearchCallback(e, { results, options }) {\r\n    this.matches = results.matches;\r\n    this.setCurrentMatchIndex();\r\n    this.teardownSearchNavigation();\r\n    this.renderSearchNavigation();\r\n    this.bindSearchNavigationEvents();\r\n    this.renderPins(results.matches);\r\n    this.toggleSearchPending(false);\r\n    if (options.goToFirstResult) {\r\n      $(document).one('BookReader:pageChanged', () => {\r\n        this.br.resize();\r\n      });\r\n    } else {\r\n      this.br.resize();\r\n    }\r\n  }\r\n\r\n  handleSearchStarted() {\r\n    this.emptyMatches();\r\n    this.br.removeSearchHilites();\r\n    this.removeResultPins();\r\n    this.toggleSearchPending(true);\r\n    this.teardownSearchNavigation();\r\n    this.setQuery(this.br.searchTerm);\r\n  }\r\n\r\n  /**\r\n   * Event listener for: `BookReader:SearchCallbackError`\r\n   * @param {CustomEvent} event\r\n   */\r\n  handleSearchCallbackError(event = {}) {\r\n    this.toggleSearchPending(false);\r\n    const isIndexed = event?.detail?.props?.results?.indexed;\r\n    this.renderErrorModal(isIndexed);\r\n  }\r\n\r\n  handleSearchCallbackBookNotIndexed() {\r\n    this.toggleSearchPending(false);\r\n    this.renderBookNotIndexedModal();\r\n  }\r\n\r\n  handleSearchCallbackEmpty() {\r\n    this.toggleSearchPending(false);\r\n    this.renderResultsEmptyModal();\r\n  }\r\n\r\n  bindEvents() {\r\n    const namespace = 'BookReader:';\r\n\r\n    window.addEventListener(`${namespace}SearchCallbackError`, this.handleSearchCallbackError.bind(this));\r\n    $(document).on(`${namespace}SearchCallback`, this.handleSearchCallback.bind(this))\r\n      .on(`${namespace}SearchStarted`, this.handleSearchStarted.bind(this))\r\n      .on(`${namespace}SearchCallbackBookNotIndexed`, this.handleSearchCallbackBookNotIndexed.bind(this))\r\n      .on(`${namespace}SearchCallbackEmpty`, this.handleSearchCallbackEmpty.bind(this))\r\n      .on(`${namespace}pageChanged`, this.updateSearchNavigation.bind(this));\r\n\r\n    this.dom.toolbarSearch.querySelector('form').addEventListener('submit', this.submitHandler.bind(this));\r\n  }\r\n}\r\n\r\nexport default SearchView;\r\n"],"names":["poll","renderBoxesInPageContainerLayer","SearchView","marshallSearchResults","jQuery","extend","BookReader","defaultOptions","server","bookId","subPrefix","bookPath","enableSearch","searchInsideProtocol","searchInsideUrl","searchInsidePreTag","searchInsidePostTag","initialSearchTerm","prototype","setup","super_","options","call","searchTerm","searchResults","searchXHR","_cancelSearch","bind","cancelSearchRequest","_searchBoxesByIndex","searchView","undefined","init","br","searchCancelledCallback","trigger","term","instance","search","goToFirstResult","suppressFragmentChange","buildToolbarElement","$el","dom","toolbarSearch","find","after","_createPageContainer","index","pageContainer","page","pageIndex","boxes","$container","map","b","matchIndex","overrides","disablePopup","error","success","searchCancelled","replace","eventNames","fragmentChange","serverPath","baseUrl","path","subPrefixWithSlash","length","lastIndexOf","substr","urlParams","item_id","doc","q","pre_tag","post_tag","paramStr","$","param","url","callSearchResultsCallback","searchInsideResults","responseHasError","matches","hasCustomError","hasCustomSuccess","console","BRSearchCallbackError","BRSearchCallback","ajax","dataType","cache","beforeSend","xhr","abort","clearSearchFieldAndResults","toggleSearchPending","results","pageNum","book","getPageNum","leafNumToIndex","updateSearchHilites","removeProgressPopup","_searchPluginGoToResult","_BRSearchCallbackError","basePayload","payload","Object","assign","indexed","boxesByIndex","removeSearchHilites","match","box","par","pageBoxes","push","pageIndexString","entries","parseFloat","getPage","pageContainers","getActivePageContainerElementsForIndex","container","getActivePageContainerElements","remove","onNearbyPage","Math","abs","currentIndex","makeUnviewableAtEnd","isViewable","resp","fetch","URLSearchParams","id","subprefix","leafNum","then","r","json","value","makeViewable","_modes","mode1Up","mode1UpLit","updatePages","activeMode","updateComplete","_isIndexDisplayed","jumpToIndex","$boxes","until","result","css","scrollIntoView","block","constMode1up","mode","isFullscreenActive","inline","behavior","Promise","resolve","setTimeout","removeAttr","removeSearchResults","searchHighlightVisible","visiblePages","constMode2up","twoPage","currentIndexL","currentIndexR","some","inArray","escapeHTML","escapeRegExp","renderMatch","preTag","postTag","preTagRe","postTagRe","regex","RegExp","displayPageNumberFn","displayPageNumber","html","text","constructor","cacheDOMElements","bindEvents","cancelSearch","buildToolbarSearch","setQuery","query","val","emptyMatches","removeResultPins","dispatchEventWhenComplete","teardownSearchNavigation","toggleSidebar","renderSearchNavigation","selector","before","resultsPosition","searchNavigation","positionMessage","currentMatchIndex","bindSearchNavigationEvents","namespace","on","showPrevResult","showNextResult","constModeThumb","switchMode","getClosestMatchIndex","start","end","comparator","eq","click","updateResultsPosition","updateSearchNavigationButtons","comparisonFn","matchPages","m","currentPage","closestTo","pool","slice","closestPage","indexOf","attr","off","resize","setCurrentMatchIndex","matchingSearchResult","find2upMatchingSearchResult","find1upMatchingSearchResult","updateSearchNavigation","togglePinsFor","bool","pinsVisibleState","refs","$BRfooter","visibility","document","createElement","classList","add","innerHTML","imagesBaseURL","renderPins","forEach","uiStringSearch","percentThrough","util","cssPercentage","getNumLeafs","max","substring","addClass","left","append","appendTo","event","marker","currentTarget","tooltip","querySelector","tooltipOffset","getBoundingClientRect","targetOffset","boxSizeAdjust","parseInt","getComputedStyle","paddingLeft","x","style","setProperty","removeClass","target","showProgressPopup","progressPopupClosed","renderErrorModal","textIsProcessing","errorDetails","renderModalMessage","delayModalRemovalFor","renderBookNotIndexedModal","renderResultsEmptyModal","messageHTML","modal","el","timeoutMS","submitHandler","e","preventDefault","handleSearchCallback","one","handleSearchStarted","handleSearchCallbackError","isIndexed","detail","props","handleSearchCallbackBookNotIndexed","handleSearchCallbackEmpty","window","addEventListener"],"sourceRoot":""}